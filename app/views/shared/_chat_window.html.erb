<%
  # Get all users except current user
  other_users = User.where.not(id: current_user.id)
  @recipient ||= other_users.first
%>

<div id="chat-window" class="fixed bottom-4 right-4 w-96 bg-white rounded-lg shadow-lg flex flex-col z-50 h-[600px]" data-user-id="<%= current_user.id %>" data-recipient-id="<%= @recipient&.id %>">
  <div class="flex items-center justify-between p-4 bg-gray-50 border-b border-gray-200 rounded-t-lg">
    <select id="chat-recipient" class="flex-grow mr-2 px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
      <% other_users.each do |user| %>
        <option value="<%= user.id %>" <%= 'selected' if @recipient&.id == user.id %>><%= user.email %></option>
      <% end %>
    </select>
    <div class="flex items-center space-x-2 flex-shrink-0">
      <button class="minimize-chat text-gray-500 hover:text-blue-500 focus:outline-none" type="button">
        <span class="text-xl">_</span>
      </button>
      <button class="close-chat text-gray-500 hover:text-blue-500 focus:outline-none" type="button">
        <span class="text-xl">Ã—</span>
      </button>
    </div>
  </div>
  
  <div id="messages" class="flex-grow overflow-y-auto p-4 space-y-3">
    <% if @recipient %>
      <% Message.where(
          "(user_id = ? AND recipient_id = ?) OR (user_id = ? AND recipient_id = ?)",
          current_user.id, @recipient.id,
          @recipient.id, current_user.id
        ).order(created_at: :asc).each do |message| %>
        <%= render 'messages/message', message: message %>
      <% end %>
    <% else %>
      <p class="text-center text-gray-500">Select a user to start chatting</p>
    <% end %>
  </div>
  
  <div class="p-4 border-t border-gray-200 bg-white">
    <form id="chat-form" class="flex space-x-3">
      <input 
        id="chat-input" 
        type="text" 
        placeholder="Type a message..." 
        class="flex-grow min-w-0 px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 disabled:bg-gray-100 disabled:cursor-not-allowed"
        <%= 'disabled' unless @recipient %>
      />
      <button 
        type="submit" 
        class="flex-shrink-0 px-6 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:bg-gray-400 disabled:cursor-not-allowed whitespace-nowrap"
        <%= 'disabled' unless @recipient %>
      >
        Send
      </button>
    </form>
  </div>
</div>

<% content_for :styles do %>
  <style>
    /* No styles needed, using Tailwind CSS classes */
  </style>
<% end %>